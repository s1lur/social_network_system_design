# Социальная сеть для путешественников - System Design
Домашнее задание для [курса по System Design](https://balun.courses/courses/system_design).

## Функциональные требования:
- публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия;
- оценка и комментарии постов других путешественников;
- подписка на других путешественников, чтобы следить за их активностью;
- поиск популярных мест для путешествий и просмотр постов с этих мест в виде ТОПа мест по странам и городам;
- общение с другими путешественниками в личных сообщениях;
- просмотр ленты других путешественников.

## Нефункциональные требования:
- 10 000 000 DAU
	- к концу года
	- линейный рост
- Availability 99.95%
- Каждый пользователь в день:
	- оставляет 5 реакций (оценок + комментариев)
	- подписывается на одного человека
	- отправляет 100 сообщений
	- просматривает 100 постов
	- оставляет 0.0767 постов в день (28 в год)
- Нету необходимости в гео-распределении (только СНГ)
- Нету сезонности
- В посте до 5 фото, до 300 символов в описании
- В сообщении до 1000 символов (будем считать, что в среднем 50 символов)
- Максимальное время ответа сервера - 1 секунда

## Расчеты

### Размеры сущностей
#### Пост *(~2МБ)*:
- Фотографии *5 * 400КБ = 2МБ*
- Описание *300 * 2Б = 600Б*
- ID локации *8Б*
- Дата *8Б*
#### Локация *(74Б)*:
- ID *8Б*
- Название *30Б * 2 = 60Б*
- Координаты *6Б*
#### Пользователь *(~401КБ)*:
- ID пользователя *8Б*
- ФИО *100 * 2Б = 200Б*
- Описание профиля *100 * 2 = 200Б*
- Аватарка *400КБ*
#### Комментарий *(224Б)*:
- ID автора *8Б*
- ID поста *8Б*
- Тело *100 * 2 = 200Б
- Дата *8Б*
#### Сообщение *(124Б)*:
- ID отправителя *8Б*
- ID получателя *8Б*
- Тело *50 * 2 = 100Б*
- Дата *8Б*
#### Лайк *(16Б)*:
- ID поста *8Б*
- ID пользователя *8Б*
#### Подписка *(16Б)*:
- ID подписавшегося *8Б*
- ID на кого подписались *8Б*
### Немного рассуждений
Будем считать, что sticky factor (DAU / MAU) нашего приложения 50%, то есть в месяц под конец первого года будет около 20 000 000 активных пользователей, и так как социальная сеть еще активно развивается, будем считать, что MAU - 80% от всей пользовательской базы, то есть итого у нас будет 25 000 000 зарегистрированных пользователей.
Рассчитаем размеры дисков, которые потребуются на первый год и на следующий. Так как рост линейный, то для рассчетов необходимого объема памяти можем считать, что весь первый год было 10 000 000 * (1 + 12) / 12 / 2 ≈ 5 420 000 DAU.
Объекты локаций в расчётах можно не учитывать, так как их объем незначителен.
### Собственно сами расчёты
```
Total requests per user per day = 1 + 5 + 1 + 100 + 250 = 357
RPS = 10 000 000 * 357 / 86 400 ≈ 41 320
Written data per user per day = 2МБ * 0.0767 (пост) ≈ 153КБ
Needed write speed = 153КБ * 10 000 000 / 86400 ≈ 17.7 МБ/с
Read data per user per day = 2МБ * 100 (пост) = 200МБ
Needed read speed = 200МБ * 10 000 000 / 86400 ≈ 23.2 ГБ/с
Total written data in first year = 153КБ * 5 420 000 * 365 (активность) ≈ 303ТБ
Total written data in next year = 153КБ * 10 000 000 * 365 ≈ 558ТБ
Needed disks (6TB) for storage in first year = 303ТБ / 6ТБ = 51
Needed disks (6 TB) for storage in next year = 562ТБ / 6ТБ = 93
Needed disks for read speed (HDD) = 23.2ГБ/с / 0.1ГБ/с = 232
Needed disks for read speed (SSD (SATA)) = 23.2ГБ/с / 0.5ГБ/с = 47
```
Итого берем 51 SSD (так как нам не хватит скорости чтения у HDD) на первый год, и 93 на следующий (без учета последующего роста).